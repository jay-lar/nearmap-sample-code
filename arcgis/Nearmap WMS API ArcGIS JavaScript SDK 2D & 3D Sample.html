<html>
<head>
  <meta charset="utf-8" />
  <meta
          name="viewport"
          content="initial-scale=1,maximum-scale=1,user-scalable=no"
  />
  <!--
   ArcGIS API for JavaScript, https://js.arcgis.com
   Learn more abolut Nearmap WMS here: https://docs.nearmap.com/display/ND/INTEGRATIONS
   -->
  <title>Nearmap/ArcGIS API for JavaScript WMS API Integration Sample</title>

  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>

  <link
          rel="stylesheet"
          href="https://js.arcgis.com/4.21/esri/themes/light/main.css"
  />
  <script src="https://js.arcgis.com/4.21/"></script>

  <script>
    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/views/SceneView",
      "esri/layers/WMSLayer",
      "esri/Basemap",
      "esri/geometry/SpatialReference"
    ], (Map, MapView, SceneView, WMSLayer, Basemap, SpatialReference) => {

      // User Input Variables
      const api_key = "Yzc2MjEzMWUtY2Q4YS00NTM2LTgyMDgtMDljZjI2YTdhMTMz";  // "NEARMAP_API_KEY_GOES_HERE"
      const view_type = "Map";  // Select between 3d "Scene" or 2d "Map" viewers
      const origin =  [-97.751533,30.269135];  // WGS84 Latitude & Longitude
      const origin_zoom = 18; // Zoom Level to display mapview at
      const spatial_reference = 4203; //2193; // WKID for projecting data as...
      const nearmap_min_scale = 9027.977411;  // Nearmap Imagery Lowest visible scale.
      const nearmap_max_scale = 564.248588; // 70.5310735;  // Nearmap Imagery Highest visible scale.
      // See the following for more info on scale values: https://developers.arcgis.com/documentation/mapping-apis-and-services/reference/zoom-levels-and-scale/

      // Script
      const sr = new SpatialReference({wkid: spatial_reference})

      let wmsLayer = new WMSLayer({
        visible: true,
        url: `https://api.nearmap.com/wms/v1/latest/apikey/${api_key}`,
        copyright: "Nearmap",
        spatialReference: sr,
        minScale: nearmap_min_scale,
        maxScale: nearmap_max_scale
      });


      const map = new Map({
        basemap: "topo-vector",
        ground: "world-elevation"
      });

      if (view_type.toLowerCase() === "scene") {
        const view = new SceneView({
          container: "viewDiv",
          map: map,
          zoom: origin_zoom,
          center: origin
        })
      } else if (view_type.toLowerCase() === "map") {
        const view = new MapView({
          container: "viewDiv",
          map: map,
          zoom: origin_zoom,
          center: origin
        });
      }

      map.add(wmsLayer);
    });
  </script>
</head>
<body>
<div id="viewDiv"></div>
</body>
</html>
